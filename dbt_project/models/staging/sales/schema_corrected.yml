version: 2

models:
  - name: stg_sales_orderdetail_corrected
    description: "Staged order detail data with quality flags and business logic"
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - sales_order_id
            - sales_order_detail_id
    columns:
      - name: orderdetail_sk
        description: "Surrogate key for order detail"
        tests:
          - not_null
          - unique
          
      - name: sales_order_id
        description: "Order ID"
        tests:
          - not_null
          - relationships:
              to: ref('stg_sales_orderheader_corrected')
              field: sales_order_id
              
      - name: sales_order_detail_id
        description: "Order detail ID"
        tests:
          - not_null
          
      - name: product_id
        description: "Product ID"
        tests:
          - not_null
          
      - name: order_quantity
        description: "Order quantity"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              max_value: 1000
              
      - name: unit_price
        description: "Unit price"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 100000
              
      - name: unit_price_discount
        description: "Unit price discount"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 1
              
      - name: discount_tier
        description: "Discount categorization"
        tests:
          - not_null
          - accepted_values:
              values: ['High Discount', 'Medium Discount', 'Low Discount', 'No Discount']
              
      - name: quantity_category
        description: "Quantity categorization"
        tests:
          - not_null
          - accepted_values:
              values: ['Bulk Order', 'Medium Order', 'Small Order']
              
      - name: has_data_quality_issues
        description: "Flag for data quality issues"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

  - name: stg_sales_orderheader_corrected
    description: "Staged order header data with quality flags and business logic"
    columns:
      - name: sales_order_sk
        description: "Surrogate key for order"
        tests:
          - not_null
          - unique
          
      - name: sales_order_id
        description: "Order ID"
        tests:
          - not_null
          - unique
          
      - name: customer_id
        description: "Customer ID"
        tests:
          - not_null
          - relationships:
              to: ref('stg_customers')
              field: customer_id
              
      - name: order_date
        description: "Order date"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: "'2000-01-01'"
              max_value: "current_date()"
              
      - name: total_due
        description: "Total due amount"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 1000000
              
      - name: order_status_desc
        description: "Order status description"
        tests:
          - not_null
          - accepted_values:
              values: ['In Process', 'Approved', 'Backordered', 'Rejected', 'Shipped', 'Cancelled', 'Unknown']
              
      - name: order_value_tier
        description: "Order value tier"
        tests:
          - not_null
          - accepted_values:
              values: ['High Value', 'Medium Value', 'Low Value', 'Micro Value']
              
      - name: sales_channel
        description: "Sales channel"
        tests:
          - not_null
          - accepted_values:
              values: ['Online', 'Sales Rep']
              
      - name: has_data_quality_issues
        description: "Flag for data quality issues"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]